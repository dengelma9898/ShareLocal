# @sharelocal/web - Cursor Rules

‚ö†Ô∏è **WICHTIG**: Diese Datei sollte mit `AGENTS.md` synchronisiert bleiben.
Die Quelle der Wahrheit ist `packages/web/AGENTS.md`. Diese `.cursorrules` Datei wird von Cursor automatisch eingelesen.

---

# @sharelocal/web - Agent Context

Next.js Frontend Package - Next.js 16 + React 19 + TypeScript

## Setup commands

- Install deps: `pnpm install` (vom Root) oder `pnpm --filter @sharelocal/web install`
- Start dev server: `pnpm dev` (vom Package-Root) oder `pnpm web:dev` (vom Root)
- Build: `pnpm build`
- Start production: `pnpm start`
- Run tests: `pnpm test`
- Lint: `pnpm lint`

## Dev environment tips

- App l√§uft standardm√§√üig auf `http://localhost:3000`
- Next.js App Router wird verwendet (`app/` Verzeichnis)
- Hot-Reload ist automatisch aktiviert
- Environment-Variablen: `NEXT_PUBLIC_*` f√ºr Client-seitige Variablen

## Code style

- TypeScript strict mode
- React 19 mit Server Components
- Single quotes, semicolons
- Functional Components bevorzugt
- **Tailwind CSS** f√ºr Styling ‚úÖ
- **shadcn/ui** f√ºr UI-Komponenten ‚úÖ (Copy-Paste Komponenten, keine Dependency)
- **Type Safety**: Vermeide `any` Types wo m√∂glich - verwende konkrete Types (Zod-inferred types, React types, etc.)
- **ESLint**: Keine `eslint-disable` Kommentare - wenn eine Regel zu strikt ist, entferne sie aus der ESLint-Konfiguration statt sie zu deaktivieren

## Testing instructions

### ‚úÖ Haupttest-Methode f√ºr MVP: E2E Tests
- **E2E Tests: Playwright** (`pnpm test:e2e`) - ‚úÖ Haupttest-Methode
- **Mock Mode:** `pnpm test:e2e:mocked` (schnell, keine API n√∂tig)
- **Real Mode:** `pnpm test:e2e:real` (mit echter API)
- **KRITISCH: Alle E2E Tests M√úSSEN erfolgreich sein vor jedem Commit**

### ‚ö†Ô∏è Optional: Unit Tests
- **Unit Tests: Vitest** (`pnpm test:watch` f√ºr interaktiv, `pnpm test` f√ºr einmalig)
- **Status:** Optional, nicht kritisch f√ºr MVP
- **Hinweis:** Unit Tests sind f√ºr MVP nicht erforderlich, da E2E Tests bereits die meisten F√§lle abdecken

**Wichtig:** F√ºr MVP sind E2E Tests ausreichend. Unit Tests k√∂nnen sp√§ter hinzugef√ºgt werden.

### E2E Tests mit Playwright

Playwright testet die vollst√§ndige User-Journey durch die Web-App inklusive Integration mit der Backend API.

**Test-Commands:**
```bash
# Real Mode: Alle E2E Tests mit echter API (ben√∂tigt laufende API)
pnpm test:e2e:real

# Mock Mode: Tests mit Mock-Daten (keine API n√∂tig) ‚ö°
pnpm test:e2e:mocked

# Alle Tests (beide Modi)
pnpm test:e2e

# Mit UI (interaktiv)
pnpm test:e2e:ui

# Im Browser (headed mode)
pnpm test:e2e:headed

# Debug Mode
pnpm test:e2e:debug

# Report anzeigen
pnpm test:e2e:report
```

**Mock Mode vs. Real Mode:**
- **Mock Mode** (`test:e2e:mocked`): Schnell, keine API n√∂tig, perfekt f√ºr Entwicklung
- **Real Mode** (`test:e2e:real`): Vollst√§ndige Integration, ben√∂tigt laufende Backend API
- Siehe `e2e/MOCK_MODE.md` f√ºr Details

**Test-Struktur:**
```
e2e/
‚îú‚îÄ‚îÄ auth.spec.ts              # Authentication Tests
‚îú‚îÄ‚îÄ listings.spec.ts          # Listing Discovery Tests
‚îú‚îÄ‚îÄ listings-authenticated.spec.ts  # Listing Management (authenticated)
‚îú‚îÄ‚îÄ conversations.spec.ts     # Chat Tests (sp√§ter)
‚îú‚îÄ‚îÄ fixtures.ts               # Custom Test Fixtures
‚îî‚îÄ‚îÄ helpers/
    ‚îî‚îÄ‚îÄ auth.ts               # Auth Helper Functions
```

**Wichtige Hinweise:**
- Tests laufen sequenziell f√ºr bessere API-Isolation
- **Backend API MUSS auf `http://localhost:3001` laufen** (siehe `e2e/SETUP.md`)
- Tests verwenden Test-Daten (werden automatisch erstellt/bereinigt)
- Screenshots werden bei Fehlern automatisch erstellt
- HTML Report wird nach Tests generiert

**Voraussetzungen f√ºr E2E Tests:**
1. Backend API muss laufen (`cd packages/api && pnpm dev`)
2. Database muss verf√ºgbar sein
3. Environment Variables m√ºssen gesetzt sein (`.env` im Root)
4. Siehe `e2e/SETUP.md` f√ºr vollst√§ndige Setup-Anleitung
5. Quick Start: `e2e/QUICK_START.md`

### ‚ö†Ô∏è WICHTIG: Tests m√ºssen erfolgreich sein

**Vor jedem Commit M√úSSEN alle Tests erfolgreich laufen:**
```bash
# Unit Tests
pnpm test

# E2E Tests (ben√∂tigt laufenden Dev-Server)
pnpm test:e2e
```

- ‚úÖ Alle Tests m√ºssen gr√ºn sein (0 failed)
- ‚ùå Keine fehlgeschlagenen Tests werden akzeptiert
- üîÑ Bei fehlgeschlagenen Tests: Problem beheben, Tests erneut ausf√ºhren

## Package structure

```
app/
‚îú‚îÄ‚îÄ layout.tsx        # Root Layout
‚îú‚îÄ‚îÄ page.tsx          # Home Page
‚îú‚îÄ‚îÄ globals.css       # Global Styles
‚îî‚îÄ‚îÄ [routes]/        # App Router Routes (sp√§ter)
components/           # React Components (sp√§ter)
lib/                  # Utilities (sp√§ter)
hooks/                # Custom Hooks (sp√§ter)
```

## Dependencies

- Next.js 16.x mit App Router
- React 19.x
- TypeScript 5.6+
- **Tailwind CSS** ‚úÖ
- **shadcn/ui** ‚úÖ (Radix UI + Tailwind CSS)
- **React Hook Form + Zod** ‚úÖ
- **Axios** f√ºr API Calls ‚úÖ
- next-intl f√ºr i18n (sp√§ter)

## Important notes

- Server Components sind Standard, Client Components nur wenn n√∂tig (`'use client'`)
- API Calls sollten Server Actions oder Route Handlers verwenden
- Bilder mit Next.js Image Component optimieren
- Code Splitting automatisch durch Next.js
- SEO-Metadaten in Layout/Page Metadata

## ‚ôø Accessibility (WCAG 2.1 AA Compliance) - MUSS implementiert werden

**Accessibility ist ein MUSS, nicht optional!** Alle UI-Komponenten m√ºssen barrierefrei sein.

### Grundlegende Anforderungen:

1. **Semantic HTML**
   - Korrekte HTML5-Elemente verwenden (`<nav>`, `<main>`, `<header>`, `<footer>`, etc.)
   - √úberschriften-Hierarchie einhalten (`h1` ‚Üí `h2` ‚Üí `h3`)
   - Formulare mit `<form>`, `<label>`, `<input>` korrekt strukturieren

2. **ARIA Labels & Roles**
   - `aria-label` f√ºr Icon-Buttons ohne Text
   - `aria-describedby` f√ºr Form-Felder mit Hilfetext
   - `aria-live="polite"` f√ºr dynamische Inhalte (Error Messages, Success Messages)
   - `aria-invalid` f√ºr Form-Validierung
   - `role` nur wenn n√∂tig (semantic HTML bevorzugt)

3. **Keyboard Navigation**
   - Alle interaktiven Elemente m√ºssen per Tastatur erreichbar sein
   - Focus-Indikatoren sichtbar (`focus:ring-2` in Tailwind)
   - Tab-Reihenfolge logisch
   - Skip Links f√ºr Navigation (`<a href="#main-content">Skip to main content</a>`)

4. **Screen Reader Support**
   - Alt-Text f√ºr alle Bilder (`alt` Attribute)
   - `aria-label` f√ºr dekorative Icons
   - Error Messages mit `aria-describedby` verkn√ºpfen
   - Loading States mit `aria-busy="true"`

5. **Color Contrast**
   - Mindestens WCAG AA: 4.5:1 f√ºr normalen Text, 3:1 f√ºr gro√üe Texte
   - Nicht nur Farbe f√ºr Information verwenden (Icons, Text erg√§nzen)

6. **Form Validation**
   - Error Messages direkt nach dem Input-Feld
   - `aria-invalid="true"` bei Fehlern
   - `aria-describedby` auf Error-Message verweisen
   - Focus auf erstes fehlerhaftes Feld nach Submit

7. **Focus Management**
   - Focus nach Modal-√ñffnung ins Modal
   - Focus nach Submit auf Success/Error Message
   - Focus Trap in Modals

### Tools f√ºr Testing:

- **Lighthouse** (Chrome DevTools) - Accessibility Score
- **axe DevTools** Browser Extension
- **WAVE** Browser Extension
- **Keyboard Navigation** - Manuell testen mit Tab/Enter/Space
- **Screen Reader** - NVDA (Windows), VoiceOver (macOS), JAWS

### Beispiel f√ºr accessible Form:

```tsx
<div>
  <label htmlFor="email" className="block text-sm font-medium">
    E-Mail-Adresse
  </label>
  <input
    id="email"
    type="email"
    aria-invalid={errors.email ? 'true' : 'false'}
    aria-describedby={errors.email ? 'email-error' : undefined}
    autoComplete="email"
  />
  {errors.email && (
    <p id="email-error" role="alert" className="text-red-600">
      {errors.email.message}
    </p>
  )}
</div>
```

### Checkliste vor jedem Commit:

- [ ] Alle Buttons haben Text oder `aria-label`
- [ ] Alle Form-Felder haben `<label>` mit `htmlFor`
- [ ] Error Messages haben `role="alert"` und `aria-describedby`
- [ ] Keyboard Navigation funktioniert (Tab, Enter, Space)
- [ ] Focus-Indikatoren sind sichtbar
- [ ] Color Contrast erf√ºllt WCAG AA
- [ ] Screen Reader kann alle Inhalte lesen
- [ ] Skip Links vorhanden (bei komplexen Layouts)

## ‚ö†Ô∏è WICHTIG: Build UND Dev-Start m√ºssen erfolgreich sein

**Vor dem Abschlie√üen von √Ñnderungen M√úSSEN beide Checks erfolgreich sein:**

### 1. Build Check
```bash
pnpm build
```
- Next.js Build muss ohne Fehler durchlaufen
- Alle Type-Checks m√ºssen bestehen

### 2. Dev-Start Check
```bash
pnpm dev
```
- Next.js Dev-Server muss ohne Runtime-Fehler starten k√∂nnen
- Keine unhandled exceptions
- Alle Imports m√ºssen aufgel√∂st werden k√∂nnen

**Wichtig**: Build und Dev-Start k√∂nnen unterschiedliche Fehler zeigen:
- Build pr√ºft Type-Checks und Production-Build
- Dev-Start zeigt Runtime-Fehler beim Starten
- **Beide m√ºssen erfolgreich sein**, bevor √Ñnderungen als abgeschlossen gelten

Bei Fehlern:
- Build-Fehler: `pnpm tsc --noEmit` f√ºr detaillierte TypeScript-Fehlermeldungen
- Runtime-Fehler: Pr√ºfe die Console-Ausgabe beim `pnpm dev` Start

